<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ddzlancamento" language="groovy" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" isIgnorePagination="true" uuid="95d463c0-ef51-4bfe-ae42-2b8cb0e9bd15">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="linha" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="dataini" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="datafim" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="logo" class="java.io.InputStream">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="flag" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="obs" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
     DDZ_Controle."ID" AS DDZ_ID,
     DDZ."DATA_INPUT" AS DATA_INPUT,
     DDZ."HORA_INPUT" AS HORA_INPUT,
     DDZ."ID_M_MATERIAL" AS ID_M_MATERIAL,
     Cad_Linha."LINHA" AS Cad_Linha_LINHA,
     FORMAT(DDZ_Controle."SCRAP_TOTAL", 'C', 'pt-br')  AS SCRAP_TOTAL_REAIS,
     DDZ_Controle."SCRAP_TOTAL"  AS SCRAP_TOTAL,
     FLAG
FROM
     "dbo"."Cad_Linha" Cad_Linha INNER JOIN "dbo"."Cad_Material" Cad_Material ON Cad_Linha."LINHA" = Cad_Material."MAT_LINHA"
     INNER JOIN "dbo"."DDZ" DDZ ON Cad_Material."MATERIAL" = DDZ."ID_M_MATERIAL"
     INNER JOIN "dbo"."Velocidade_Perfil" Velocidade_Perfil ON Cad_Material."ID_MATERIAL" = Velocidade_Perfil."ID_MATERIAL_ID"
     INNER JOIN "dbo"."Causas" Causas ON DDZ."ID_CAUSA_ID" = Causas."ID"
     INNER JOIN "dbo"."DDZ_Controle" DDZ_Controle ON DDZ."ID_CONTROLE" = DDZ_Controle."ID"

WHERE
     DATA_INPUT BETWEEN CONVERT(DATE,$P{dataini},111)AND CONVERT(DATE,$P{datafim},111)
     and DDZ.Flag = $P{flag}
     and (Causas."DESC_CAUSA" LIKE '%$P!{obs}%'
     or DDZ."OBSERVACAO" LIKE '%$P!{obs}%')
ORDER BY
     DATA_INPUT ASC,
     HORA_INPUT ASC]]>
	</queryString>
	<field name="DDZ_ID" class="java.lang.Integer"/>
	<field name="DATA_INPUT" class="java.sql.Timestamp"/>
	<field name="HORA_INPUT" class="java.sql.Timestamp"/>
	<field name="ID_M_MATERIAL" class="java.lang.Integer"/>
	<field name="Cad_Linha_LINHA" class="java.lang.String"/>
	<field name="SCRAP_TOTAL_REAIS" class="java.lang.String"/>
	<field name="SCRAP_TOTAL" class="java.lang.Double"/>
	<field name="FLAG" class="java.lang.String"/>
	<variable name="variable1" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{SCRAP_TOTAL}]]></variableExpression>
	</variable>
	<variable name="Contagem" class="java.lang.Integer" calculation="Count">
		<variableExpression><![CDATA[$F{ID_M_MATERIAL}]]></variableExpression>
	</variable>
	<variable name="Total" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{SCRAP_TOTAL}]]></variableExpression>
	</variable>
	<variable name="Teste" class="java.lang.String">
		<variableExpression><![CDATA[$F{Cad_Linha_LINHA} + " - " + $F{ID_M_MATERIAL} + " / " + $V{Contagem}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="76">
			<image isUsingCache="true">
				<reportElement x="55" y="0" width="176" height="40" uuid="812fd85c-3a77-4c54-8efa-bcdaa3f88de5"/>
				<imageExpression><![CDATA[$P{logo}]]></imageExpression>
			</image>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="723" y="20" width="80" height="20" uuid="d5ad9f1e-a624-4795-af83-33ea0f6bd7fb"/>
				<textElement verticalAlignment="Middle">
					<font isUnderline="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{datafim}]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="733" y="0" width="70" height="20" uuid="7a3c6bf7-cc0c-487c-8177-aa7eea77a5d3"/>
				<textElement verticalAlignment="Middle">
					<font isUnderline="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{dataini}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="677" y="0" width="56" height="20" uuid="de054a3a-b06c-4b3a-a56f-1d94884eac8a"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" isUnderline="false"/>
				</textElement>
				<text><![CDATA[Data início:]]></text>
			</staticText>
			<staticText>
				<reportElement x="677" y="20" width="46" height="20" uuid="3b8d9938-8418-4ba2-a3ec-8c93e41bd836"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true" isUnderline="false"/>
				</textElement>
				<text><![CDATA[Data fim:]]></text>
			</staticText>
			<textField>
				<reportElement x="411" y="32" width="391" height="35" uuid="32c0166b-1e35-447b-8988-60e5baf15a03"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="16" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{obs}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="32" width="722" height="35" uuid="4df5d7d5-46bf-4f30-a69b-5b85cf91b682"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="16" isBold="true"/>
				</textElement>
				<text><![CDATA[Scrap (R$) - ]]></text>
			</staticText>
		</band>
	</pageHeader>
	<summary>
		<band height="465">
			<bar3DChart>
				<chart isShowLegend="false">
					<reportElement x="55" y="0" width="747" height="417" isRemoveLineWhenBlank="true" uuid="a8a31b57-4790-4b60-b512-1b45585c874b"/>
					<chartTitle position="Top"/>
					<chartSubtitle/>
					<chartLegend position="Top"/>
				</chart>
				<categoryDataset>
					<categorySeries>
						<seriesExpression><![CDATA[$F{FLAG}]]></seriesExpression>
						<categoryExpression><![CDATA[$V{Teste}]]></categoryExpression>
						<valueExpression><![CDATA[$F{SCRAP_TOTAL}]]></valueExpression>
						<labelExpression><![CDATA[$F{SCRAP_TOTAL_REAIS}]]></labelExpression>
					</categorySeries>
				</categoryDataset>
				<bar3DPlot isShowLabels="true">
					<plot labelRotation="30.0">
						<seriesColor seriesOrder="0" color="#4296E7"/>
					</plot>
					<itemLabel>
						<font size="4"/>
					</itemLabel>
					<categoryAxisFormat labelRotation="30.0">
						<axisFormat/>
					</categoryAxisFormat>
					<valueAxisFormat>
						<axisFormat/>
					</valueAxisFormat>
				</bar3DPlot>
			</bar3DChart>
			<textField>
				<reportElement x="231" y="433" width="124" height="20" forecolor="#FF0000" uuid="a0b53124-b584-408c-b90a-b847c7731b44"/>
				<textElement verticalAlignment="Middle">
					<font size="14" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{Contagem}]]></textFieldExpression>
			</textField>
			<textField pattern="¤ #,##0.00">
				<reportElement x="525" y="433" width="142" height="20" forecolor="#FF0000" uuid="74a395df-6d9f-4c91-8d33-0a43a15e6b48"/>
				<textElement verticalAlignment="Middle">
					<font size="14" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$V{Total}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="165" y="433" width="66" height="20" uuid="837912ef-8423-448e-aed4-922096c35c0d">
					<printWhenExpression><![CDATA[$F{FLAG}.equals("P")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[Paradas:]]></text>
			</staticText>
			<staticText>
				<reportElement x="482" y="433" width="43" height="20" uuid="03016906-8db5-4cd7-bb44-c7385426107d"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[Total:]]></text>
			</staticText>
			<staticText>
				<reportElement x="132" y="433" width="99" height="20" uuid="ce1a736e-1ef9-4f81-9bf9-5087787b8094">
					<printWhenExpression><![CDATA[$F{FLAG}.equals("E")]]></printWhenExpression>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[Lançamentos:]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
